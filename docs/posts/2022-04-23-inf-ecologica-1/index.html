<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Juan Dodyk: ¿A dónde fueron los votos de Massa?</title>

<meta property="description" itemprop="description" content=""/>

<link rel="canonical" href="http://juandodyk.github.io/posts/2022-04-23-inf-ecologica-1/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2015-11-27"/>
<meta property="article:created" itemprop="dateCreated" content="2015-11-27"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Juan Dodyk: ¿A dónde fueron los votos de Massa?"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:url" content="http://juandodyk.github.io/posts/2022-04-23-inf-ecologica-1/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Juan Dodyk"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Juan Dodyk: ¿A dónde fueron los votos de Massa?"/>
<meta property="twitter:description" content=""/>
<meta property="twitter:url" content="http://juandodyk.github.io/posts/2022-04-23-inf-ecologica-1/"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["¿A dónde fueron los votos de Massa?"]},{"type":"character","attributes":{},"value":[""]},{"type":"character","attributes":{},"value":["2015-11-27"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["http://juandodyk.github.io/posts/2022-04-23-inf-ecologica-1/"]},{"type":"character","attributes":{},"value":["http://juandodyk.github.io/posts/2022-04-23-inf-ecologica-1/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["inf-ecologica-1_files/anchor-4.2.2/anchor.min.js","inf-ecologica-1_files/bowser-1.9.3/bowser.min.js","inf-ecologica-1_files/distill-2.2.21/template.v2.js","inf-ecologica-1_files/header-attrs-2.13/header-attrs.js","inf-ecologica-1_files/jquery-3.6.0/jquery-3.6.0.js","inf-ecologica-1_files/jquery-3.6.0/jquery-3.6.0.min.js","inf-ecologica-1_files/jquery-3.6.0/jquery-3.6.0.min.map","inf-ecologica-1_files/popper-2.6.0/popper.min.js","inf-ecologica-1_files/tippy-6.2.7/tippy-bundle.umd.min.js","inf-ecologica-1_files/tippy-6.2.7/tippy-light-border.css","inf-ecologica-1_files/tippy-6.2.7/tippy.css","inf-ecologica-1_files/tippy-6.2.7/tippy.umd.min.js","inf-ecologica-1_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css?family=Roboto:300|Noto+Serif:400,400italic,700,700italic&display=swap');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Roboto", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Noto Serif", sans-serif;
  --navbar-font:     "Roboto", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}


/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

d-article body {
  color: #222222;
  font-family: "Noto Serif", serif;
  font-weight: 400;
  transition: all 0.3s ease; }

:is(d-article, d-title, d-post, .posts-list .description) :is(h1, h2, h3, h4, h5, h6) {
  font-family: "Roboto", sans-serif;
  font-weight: 300;
}

a {
  text-decoration: none;
  color: #a2a2a2;
  transition: all 0.3s ease; }
a:hover {
  color: #222222;
}
a .description {
  color: #222222; transition: all 0.3s ease;
}
a .description :is(h1, h2, h3, h4, h5, h6) {
  color: #222222; transition: all 0.3s ease;
}
a:hover .description {
  color: #a2a2a2;
}
a:hover .description :is(h1, h2, h3, h4, h5, h6) {
  color: #a2a2a2;
}

d-article blockquote {
  border-left: 1px solid #ddd;
  color: #6f6f6f;
  padding-left: 30px;
  margin-bottom: 1.0em;
  margin: 0;

  p:last-of-type {
    margin-bottom: 0;
  }
}

d-article p a { color: #00b9e7; }
d-article p a:hover { color: #e70000; }</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.13/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"¿A dónde fueron los votos de Massa?","description":"","authors":[],"publishedDate":"2015-11-27T00:00:00.000-05:00"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Juan Dodyk</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../research.html">Research</a>
<a href="../../files/cv.pdf">CV</a>
<a href="../../teaching.html">Teaching</a>
<a href="../../blog.html">Blog</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>¿A dónde fueron los votos de Massa?</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#primer-modelo-goodman-remixado">Primer modelo: Goodman
remixado</a></li>
<li><a
href="#segundo-modelo-king-rosen-y-tanner-nonlinear-least-squares">Segundo
modelo: King, Rosen y Tanner, nonlinear least squares</a></li>
<li><a href="#conclusión">Conclusión</a></li>
<li><a href="#trabajo-futuro">Trabajo futuro</a></li>
<li><a href="#notas">Notas</a>
<ul>
<li><a href="#primer-modelo-código-r">Primer modelo: código R</a></li>
<li><a href="#segundo-modelo-código-r">Segundo modelo: código R</a></li>
</ul></li>
</ul>
</nav>
</div>
<p>La pregunta del título no tiene respuesta: el voto es secreto. Pero
igual queremos saber. La matemática nos permite hacer trampa. Lo primero
que tenemos que hacer es generalizar la pregunta: ¿cómo se transfirieron
los votos que obtuvo cada candidato presidencial en las elecciones
generales a los dos candidatos que compitieron en el ballotage?</p>
<h2 id="primer-modelo-goodman-remixado">Primer modelo: Goodman
remixado</h2>
<p>Podemos formular la pregunta así. Numeremos los candidatos de la
primera vuelta: Scioli, Macri, Massa, Del Caño, Stolbizer, Rodríguez Saá
serán 1, 2, …, 6, respectivamente. Agregamos una opción 7: no ir a votar
o votar no afirmativamente (en blanco, nulo, etc.) Llamemos <span
class="math inline">\(A_1, A_2, \ldots, A_7\)</span> a la cantidad de
votos que obtuvo cada candidato en las elecciones generales,
respectivamente.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Candidato</th>
<th style="text-align: center;">Cantidad de votos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(A_1\)</span></td>
<td style="text-align: center;">Scioli</td>
<td style="text-align: center;">9002242</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span
class="math inline">\(A_2\)</span></td>
<td style="text-align: center;">Macri</td>
<td style="text-align: center;">8382610</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(A_3\)</span></td>
<td style="text-align: center;">Massa</td>
<td style="text-align: center;">5211705</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span
class="math inline">\(A_4\)</span></td>
<td style="text-align: center;">Del Caño</td>
<td style="text-align: center;">798031</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(A_5\)</span></td>
<td style="text-align: center;">Stolbizer</td>
<td style="text-align: center;">619051</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span
class="math inline">\(A_6\)</span></td>
<td style="text-align: center;">Rodríguez Saá</td>
<td style="text-align: center;">407202</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(A_7\)</span></td>
<td style="text-align: center;">No Votó/Blanco</td>
<td style="text-align: center;">7642568</td>
</tr>
</tbody>
</table>
<p>Llamemos <span class="math inline">\(B_1\)</span> y <span
class="math inline">\(B_2\)</span> a la cantidad de gente que votó a
Scioli y a Macri, respectivamente, en la <em>segunda</em> vuelta; y
<span class="math inline">\(B_3\)</span> al resto, como <span
class="math inline">\(A_7\)</span>.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Candidato</th>
<th style="text-align: center;">Cantidad de votos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(B_1\)</span></td>
<td style="text-align: center;">Scioli</td>
<td style="text-align: center;">12198441</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span
class="math inline">\(B_2\)</span></td>
<td style="text-align: center;">Macri</td>
<td style="text-align: center;">12903301</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span
class="math inline">\(B_3\)</span></td>
<td style="text-align: center;">No Votó/Blanco</td>
<td style="text-align: center;">6962942</td>
</tr>
</tbody>
</table>
<p>Lo que buscamos es la matriz de transferencia, es decir, una matriz
<span class="math inline">\(T\)</span> con 7 filas y 3 columnas tal que
<span class="math inline">\(T_{ij}\)</span> sea la cantidad de votos del
candidato <span class="math inline">\(i\)</span> en las generales que
fueron al candidato <span class="math inline">\(j\)</span> en la segunda
vuelta. La pregunta ¿a dónde fueron los votos de Massa? se transforma en
¿cuánto valen <span class="math inline">\(T_{3,1}\)</span> y <span
class="math inline">\(T_{3,2}\)</span>?</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Scioli</th>
<th style="text-align: center;">Macri</th>
<th style="text-align: center;">No Votó/Blanco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Scioli</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{1,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{1,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{1,3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Macri</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{2,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{2,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{2,3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Massa</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{3,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{3,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{3,3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Del Caño</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{4,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{4,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{4,3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Stolbizer</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{5,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{5,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{5,3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rodríguez Saá</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{6,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{6,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{6,3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>No Votó/Blanco</strong></td>
<td style="text-align: center;"><span
class="math inline">\(T_{7,1}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{7,2}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(T_{7,3}\)</span></td>
</tr>
</tbody>
</table>
<p>Tenemos que <span
class="math inline">\(T_{i1}+T_{i2}+T_{i3}=A_i\)</span> para cada <span
class="math inline">\(i\)</span>, ya que los votos del candidato <span
class="math inline">\(i\)</span> en la primera vuelta tuvieron que ir a
algún candidato en la segunda vuelta (o al “no candidato” que representa
ausentarse o emitir un voto no afirmativo), así que sumados dan todos
los votos iniciales para ese candidato, es decir, <span
class="math inline">\(A_i\)</span>.</p>
<p>Tenemos, por otro lado, que <span
class="math inline">\(T_{1j}+T_{2j}+\cdots+T_{7j}=B_j\)</span> para cada
<span class="math inline">\(j\)</span>, ya que los votos del candidato
<span class="math inline">\(j\)</span> en la segunda vuelta tuvieron que
provenir de algún candidato (o del “no candidato”) en la primera.</p>
<p>Definimos ahora otra matriz de las mismas dimensiones de <span
class="math inline">\(T\)</span> así: <span class="math inline">\(X_{ij}
= T_{ij}/A_i\)</span>. Es decir, <span
class="math inline">\(X_{ij}\)</span> es la proporción de votantes de
<span class="math inline">\(i\)</span> en primera vuelta que votaron a
<span class="math inline">\(j\)</span> en segunda vuelta. Las dos
ecuaciones que obtuvimos se reescriben así: <span
class="math inline">\(X_{i1}+X_{i2}+X_{i3}=1\)</span> para cada <span
class="math inline">\(i\)</span>, y <span
class="math inline">\(AX=B\)</span>, donde <span
class="math inline">\(AX\)</span> es la multiplicación de matrices,
entendiendo <span class="math inline">\(A\)</span> y <span
class="math inline">\(B\)</span> como vectores horizontales:</p>
<p><span class="math display">\[(\begin{array}{ccc} A_1 &amp; \cdots
&amp; A_7 \end{array})\left(\begin{array}{ccc}
X_{11}&amp;X_{12}&amp;X_{13} \\ &amp; \vdots&amp; \\
X_{71}&amp;X_{72}&amp;X_{73}\end{array}\right)=\left(\begin{array}{ccc}
B_1&amp;B_2&amp;B_3\end{array}\right).\]</span></p>
<p>(Además sabemos que los números <span
class="math inline">\(X_{ij}\)</span> son no negativos: <span
class="math inline">\(X_{ij}\geqq0\)</span>.) Esto da un sistema de
ecuaciones lineales con <span class="math inline">\(3\times
7=21\)</span> incógnitas y <span class="math inline">\(7+3=10\)</span>
ecuaciones. Es obviamente indeterminado: el voto sigue siendo
secreto.</p>
<p>Pero sabemos algo más que los vectores <span
class="math inline">\(A\)</span> y <span
class="math inline">\(B\)</span>. Contamos con los datos desagregados
por mesa. Es decir, para cada mesa de votación del país sabemos cuánta
gente estaba empadronada para votar ahí, cuánta gente votó a cada
candidato, cuánta votó en blanco, nulo, etc. Tanto en las generales como
en la segunda vuelta.</p>
<p>Supongamos que en lugar de mirar el resultado de la elección a nivel
global (la cantidad de votos total que recibió cada candidato en las
elecciones) lo miramos a nivel local, en cada mesa. El razonamiento
sobre la transferencia de votos se mantiene: en cada mesa podemos
definir una matriz <span class="math inline">\(X\)</span> de
transferencia de votos en esa mesa. Ahora <strong>supongamos que la
matriz de transferencia es la misma en cada mesa</strong>. Eso es
obviamente falso, pero desoigamos a la realidad por un momento. En ese
caso, si tomamos cada mesa y apilamos sus vectores horizontales de
resultados formando matrices <span class="math inline">\(A\)</span>, de
7 columnas y <span class="math inline">\(P\)</span> filas (donde <span
class="math inline">\(P\)</span> es la cantidad de mesas) y <span
class="math inline">\(B\)</span>, de 3 columnas y <span
class="math inline">\(P\)</span> filas, la ecuación matricial <span
class="math inline">\(AX=B\)</span> se mantiene.</p>
<p><span class="math display">\[\left(\begin{array}{ccc} 87 &amp; 11
&amp; 3 &amp; 113 &amp; 17 &amp; 32 &amp; 80\\69 &amp; 16 &amp; 2 &amp;
104 &amp; 14 &amp; 37 &amp; 104\\80 &amp; 11 &amp; 5 &amp; 102 &amp; 21
&amp; 31 &amp; 95\\72 &amp; 14 &amp; 0 &amp; 95 &amp; 13 &amp; 46 &amp;
104\\ &amp; &amp; &amp; \vdots
&amp;  &amp;  &amp;  \end{array}\right)\left(\begin{array}{ccc}
X_{11}&amp;X_{12}&amp;X_{13} \\ &amp; \vdots&amp; \\
X_{71}&amp;X_{72}&amp;X_{73}\end{array}\right)=\left(\begin{array}{ccc}
113 &amp; 138 &amp; 92\\101 &amp; 138 &amp; 107\\106 &amp; 139 &amp;
100\\105 &amp; 134 &amp; 105\\ &amp; \vdots &amp;
\end{array}\right)\]</span></p>
<p>Sigue teniendo 21 incógnitas. Pero ahora tiene <span
class="math inline">\(7+3P\)</span> ecuaciones. Hay más de 90 mil mesas.
Seguimos teniendo un sistema de ecuaciones lineales, sólo que pasó de
<i>in</i>determinado a <i>sobre</i>determinado.</p>
<p>Que sea sobredeterminado es bueno. No podemos buscar la solución,
porque no existe, pero podemos buscar la “solución” que le erre por
menos margen. Es decir la matriz <span class="math inline">\(X\)</span>
tal que la suma de los cuadrados de los elementos de <span
class="math inline">\(AX-B\)</span> (el error) sea mínima. Apuntamos,
pues, a minimizar <span
class="math inline">\(f(X)=\sum_{p=1}^P\sum_{j=1}^3
(AX-B)_{pj}^2\)</span> bajo dos restricciones: <span
class="math inline">\(X_{i1}+X_{i2}+X_{i3}=1\)</span> para cada <span
class="math inline">\(i\)</span>, y <span
class="math inline">\(X_{ij}\geqq0\)</span> para cada <span
class="math inline">\(i,j\)</span>. Esto deja de ser un sistema de
ecuaciones lineales. Pasa a ser un problema de <a
href="https://en.wikipedia.org/wiki/Quadratic_programming">programación
cuadrática</a>. Y hay algoritmos eficientes que lo resuelven con
exactitud. En R se puede implementar <a
href="#primer-modelo-código-r">así</a>. Este es el resultado:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Scioli</th>
<th style="text-align: center;">Macri</th>
<th style="text-align: center;">No Votó/Blanco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Scioli</strong></td>
<td style="text-align: center;">97.68%</td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">2.32%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Macri</strong></td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">96.19%</td>
<td style="text-align: center;">3.81%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Massa</strong></td>
<td style="text-align: center;">34.62%</td>
<td style="text-align: center;">51.94%</td>
<td style="text-align: center;">13.44%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Del Caño</strong></td>
<td style="text-align: center;">67.52%</td>
<td style="text-align: center;">5.69%</td>
<td style="text-align: center;">26.79%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Stolbizer</strong></td>
<td style="text-align: center;">17.71%</td>
<td style="text-align: center;">33.43%</td>
<td style="text-align: center;">48.86%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rodríguez Saá</strong></td>
<td style="text-align: center;">30.76%</td>
<td style="text-align: center;">55.59%</td>
<td style="text-align: center;">13.65%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>No Votó/Blanco</strong></td>
<td style="text-align: center;">8.67%</td>
<td style="text-align: center;">21.11%</td>
<td style="text-align: center;">70.22%</td>
</tr>
</tbody>
</table>
<p>¿Podemos confiar en esos números? No. Están basados en una suposición
que sabemos que es falsa: que la matriz de transición sea igual en todas
las mesas. El modelo funcionaría si lo que suponemos es que las matrices
de cada mesa son <em>aproximadamente</em> iguales. A nivel país hay
evidencia de que esto es falso: por ejemplo, el destino de los votos de
Massa es distinto en Córdoba que en la PBA. Pero a niveles subnacionales
suficientemente homogéneos (en cierto sentido) la asunción se hace
plausible.</p>
<p>¿Qué quiere decir “homogéneos”? Que en cada mesa las probabilidades
<code>P(la persona vota a Scioli en la segunda vuelta | votó a Massa en primera)</code>
son más o menos constantes. En cada mesa,
<code>P(la persona vota a Scioli en segunda vuelta)</code> varía
sensiblemente: si hay algo así como un clivaje territorial, aunque sea a
escala pequeña (por ejemplo patrones versus peones en un pueblo rural),
unas escuelas quedarán de un lado y otras del otro, lo cual afectaría
directamente esas probabilidades. Pero incluso en ese caso es plausible
que las probabilidades
<code>P(vota a X en el ballotage | votó a Y en las generales)</code>
sean constantes.</p>
<p>Esto abre el camino a una modificación del modelo: se asume que las
matrices de transición son constantes en unidades subnacionales (como
provincias o departamentos), se calculan mediante el método que describí
localmente, y al final se agregan los resultados. ¿Cómo agregamos
matrices locales en una matriz global? Convertimos la matriz <span
class="math inline">\(X\)</span> a <span
class="math inline">\(T\)</span>, que expresa la redistribución de votos
en términos absolutos (cantidad de votos) y no relativos, con la fórmula
<span class="math inline">\(T_{ij}=X_{ij}\sum_{p=1}^PA_{pi}\)</span>. Y
luego simplemente sumamos todas las matrices <span
class="math inline">\(T\)</span>.</p>
<p>Esto son los resultados tomando como unidades las provincias:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Scioli</th>
<th style="text-align: center;">Macri</th>
<th style="text-align: center;">No Votó/Blanco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Scioli</strong></td>
<td style="text-align: center;">96.27%</td>
<td style="text-align: center;">0.48%</td>
<td style="text-align: center;">3.25%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Macri</strong></td>
<td style="text-align: center;">0.06%</td>
<td style="text-align: center;">95.81%</td>
<td style="text-align: center;">4.13%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Massa</strong></td>
<td style="text-align: center;">32.51%</td>
<td style="text-align: center;">50.77%</td>
<td style="text-align: center;">16.72%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Del Caño</strong></td>
<td style="text-align: center;">54.03%</td>
<td style="text-align: center;">16.88%</td>
<td style="text-align: center;">29.09%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Stolbizer</strong></td>
<td style="text-align: center;">5.05%</td>
<td style="text-align: center;">61.02%</td>
<td style="text-align: center;">33.93%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rodríguez Saá</strong></td>
<td style="text-align: center;">29.19%</td>
<td style="text-align: center;">45.16%</td>
<td style="text-align: center;">25.65%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>No Votó/Blanco</strong></td>
<td style="text-align: center;">14.67%</td>
<td style="text-align: center;">18.61%</td>
<td style="text-align: center;">66.73%</td>
</tr>
</tbody>
</table>
<p>Esto son los resultados tomando como unidades los departamentos:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Scioli</th>
<th style="text-align: center;">Macri</th>
<th style="text-align: center;">No Votó/Blanco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Scioli</strong></td>
<td style="text-align: center;">95.22%</td>
<td style="text-align: center;">1.11%</td>
<td style="text-align: center;">3.67%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Macri</strong></td>
<td style="text-align: center;">0.45%</td>
<td style="text-align: center;">94.7%</td>
<td style="text-align: center;">4.85%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Massa</strong></td>
<td style="text-align: center;">30.81%</td>
<td style="text-align: center;">49.76%</td>
<td style="text-align: center;">19.44%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Del Caño</strong></td>
<td style="text-align: center;">39.09%</td>
<td style="text-align: center;">29.25%</td>
<td style="text-align: center;">31.66%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Stolbizer</strong></td>
<td style="text-align: center;">12.33%</td>
<td style="text-align: center;">59.45%</td>
<td style="text-align: center;">28.22%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rodríguez Saá</strong></td>
<td style="text-align: center;">38.87%</td>
<td style="text-align: center;">39.74%</td>
<td style="text-align: center;">21.39%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>No Votó/Blanco</strong></td>
<td style="text-align: center;">17.28%</td>
<td style="text-align: center;">18.92%</td>
<td style="text-align: center;">63.8%</td>
</tr>
</tbody>
</table>
<p>Un argumento en contra de correr el modelo sobre unidades pequeñas y
luego agregar los resultados es que si se corre sobre pocas mesas la
información con la que se cuenta es poca, y por lo tanto el resultado
puede ser arbitrario. Pensemos en el ejemplo extremo: si hay sólo una
mesa, estamos en la situación de indeterminación de la que partimos.
Además no sólo hacen falta muchas mesas sino mesas en las que el
resultado de la elección sea suficientemente disímil: si en todas las
mesas pasó lo mismo es como si hubiera una sola.</p>
<p>Surgen pues preguntas que dejo abiertas: cómo expresar estas ideas en
un modelo estadístico riguroso, y cómo detectar cuándo el modelo tiene
“poca información”. Esto último permitiría elegir las unidades
subnacionales mínimas donde hay información suficiente.</p>
<p>Pueden bajar el código y los datos <a
href="../../files/data/Transferencia_Primera_Segunda_vuelta_via_QP.zip">acá</a>.</p>
<h2
id="segundo-modelo-king-rosen-y-tanner-nonlinear-least-squares">Segundo
modelo: King, Rosen y Tanner, nonlinear least squares</h2>
<p>El modelo que acabo de describir se basa en el que propuso Leo
Goodman en su paper <a
href="http://www.jstor.org/stable/2088121">Ecological Regressions and
Behavior of Individuals</a>, publicado en 1953. En 1997 <a
href="http://gking.harvard.edu/">Gary King</a> publicó un <a
href="http://gking.harvard.edu/eicamera/kinroot.html">libro</a> en el
que propuso un modelo superador. En el 99, junto a Ori Rosen y Martin
Tanner, <a
href="http://gking.harvard.edu/files/abs/binom-abs.shtml">extendió</a>
el trabajo del libro incoporando <a
href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">MCMC</a> y
haciendo posible la aplicación a cantidades de datos más grandes, pero
acotado a tablas de <span class="math inline">\(2\times2\)</span> (el
caso que nos interesa es de <span
class="math inline">\(7\times3\)</span>). En el 2001 <a
href="http://gking.harvard.edu/files/abs/rosen-abs.shtml">extendieron</a>
el modelo a tablas de tamaño general, lo que se aplica directamente
sobre nuestro problema. Voy a hacer un comentario sobre ese <a
href="http://gking.harvard.edu/files/gking/files/em.pdf?m=1360038990">paper</a>.</p>
<p>El modelo de King, Rosen y Taner plantea lo siguiente. En cada mesa,
el resultado de la elección en la segunda vuelta, es decir los números
<span class="math inline">\(B_1,B_2,B_3\)</span> (para seguir con la
notación que introduje en la sección anterior), se distribuye de acuerdo
a una <a
href="https://en.wikipedia.org/wiki/Multinomial_distribution">distribución
multinomial</a> con parámetros <span
class="math inline">\(\theta_1,\theta_2,\theta_3\)</span>, donde <span
class="math inline">\(\theta_j=\frac1{N}\sum_{i=1}^7A_i\beta_{ij}\)</span>,
<span class="math inline">\(N=\sum_{i=1}^7A_i\)</span> es la cantidad de
electores de la mesa y <span
class="math inline">\(\beta\in\mathbb{R}^{7\times 3}\)</span> es una
variable aleatoria que funciona como una estimación del <span
class="math inline">\(X_{ij}\)</span> de la mesa.</p>
<p>Dejamos de asumir que las matrices de transferencia de cada mesa son
iguales. Por lo tanto hay una variable <span
class="math inline">\(\beta^p\)</span> por cada mesa <span
class="math inline">\(p\)</span>. Los vectores <span
class="math inline">\(\beta^p_i=(\beta^p_{i1},\beta^p_{i2},\beta^p_{i3})\)</span>,
según el modelo, siguen <a
href="https://en.wikipedia.org/wiki/Dirichlet_distribution">distribuciones
de Dirichlet</a> independientes con parámetros <span
class="math inline">\((d_ie^{\gamma_{i1}},d_ie^{\gamma_{i2}},d_i)\)</span>
(notar que estos parámetros son los mismos para todas las mesas).
Finalmente, los parámetros <span
class="math inline">\(\gamma_{i1},\gamma_{i2}\)</span> son
independientes (desconocidos) y <span class="math inline">\(d_i\)</span>
sigue una <a
href="https://en.wikipedia.org/wiki/Exponential_distribution">distribución
exponencial</a> con media <span class="math inline">\(1/\lambda\)</span>
(<span class="math inline">\(\lambda\)</span> está fijo; puede ser <span
class="math inline">\(2\)</span>, por ejemplo).</p>
<p>La idea es estimar los parámetros <span
class="math inline">\(\gamma\)</span> en base a las observaciones (los
resultados por mesa). Si <span
class="math inline">\(f(A^p,\gamma)=\text{E}(B^p|\gamma)\)</span>
tenemos <span class="math inline">\(B^p=f(A^p,\gamma)+\epsilon\)</span>,
donde <span class="math inline">\(\epsilon\)</span> es un error con
media cero. El método consiste en tomar los <span
class="math inline">\(\gamma\)</span> que minimizan la desviación
cuadrática <span
class="math inline">\(\text{SSE}(\gamma)=\sum_{p=1}^P\sum_{j=1}^3(B_j^p-f(A^p,\gamma)_j)^2\)</span>.</p>
<p>Hay que calcular <span
class="math inline">\(f(A^p,\gamma)_j\)</span>. Es <span
class="math inline">\(\text{E}(B_j^p|\gamma)\)</span>. Como <span
class="math inline">\(B_j^p\)</span> tiene distribución multinomial,
<span
class="math display">\[\text{E}(B_j^p|\gamma)=\text{E}(\text{E}(B_j^p|\beta,\gamma)|\gamma)=\text{E}\left(\sum_{i=1}^7A_i^p\beta_{ij}^p|\gamma\right)=\]</span>
<span
class="math display">\[=\sum_{i=1}^7A_i^p\text{E}(\beta_{ij}^p|\gamma)=\sum_{i=1}^7A^p_i\frac{d_ie^{\gamma_{ij}}}{d_i(1+e^{\gamma_{i1}}+e^{\gamma_{i2}})}=\sum_{i=1}^7\frac{e^{\gamma_{ij}}A^p_i}{1+e^{\gamma_{i1}}+e^{\gamma_{i2}}}.\]</span></p>
<p>(Usé que <span class="math inline">\(X_{ij}^p\)</span> sigue la
distribución Dirichlet que definí más arriba para calcular <span
class="math inline">\(\text{E}(\beta_{ij}^p|\gamma)\)</span>.) Entonces
buscamos los <span class="math inline">\(\gamma_{ij}\)</span> que
minimizan la función <span
class="math display">\[\text{SSE}(\gamma)=\sum_{p=1}^P\sum_{j=1}^3\left(B_j^p-\sum_{i=1}^7\frac{e^{\gamma_{ij}}A^p_i}{1+e^{\gamma_{i1}}+e^{\gamma_{i2}}}\right)^2.\]</span></p>
<p>En base a eso no podemos conocer los <span
class="math inline">\(X^p\)</span> (lo que en realidad buscamos) por
mesa, pero aceptando la estimación de los <span
class="math inline">\(\gamma\)</span> podemos aproximarlos por <span
class="math inline">\(\text{E}(\beta^p)\)</span>. Esto nos da <span
class="math inline">\(X_{ij}=\frac{e^{\gamma_{ij}}}{1+e^{\gamma_{i1}}+e^{\gamma_{i2}}}\)</span>
para <span class="math inline">\(j=1,2\)</span> y <span
class="math inline">\(X_{i3}=1-X_{i1}-X_{i2}\)</span>. El resultado es
este:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Scioli</th>
<th style="text-align: center;">Macri</th>
<th style="text-align: center;">No Votó/Blanco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Scioli</strong></td>
<td style="text-align: center;">99.7%</td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">0.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Macri</strong></td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">99.91%</td>
<td style="text-align: center;">0.09%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Massa</strong></td>
<td style="text-align: center;">32.78%</td>
<td style="text-align: center;">52.92%</td>
<td style="text-align: center;">14.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Del Caño</strong></td>
<td style="text-align: center;">70.68%</td>
<td style="text-align: center;">4.91%</td>
<td style="text-align: center;">24.41%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Stolbizer</strong></td>
<td style="text-align: center;">21.65%</td>
<td style="text-align: center;">21.28%</td>
<td style="text-align: center;">57.08%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Rodríguez Saá</strong></td>
<td style="text-align: center;">32.9%</td>
<td style="text-align: center;">53.52%</td>
<td style="text-align: center;">13.58%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>No Votó/Blanco</strong></td>
<td style="text-align: center;">6.41%</td>
<td style="text-align: center;">17.2%</td>
<td style="text-align: center;">76.39%</td>
</tr>
</tbody>
</table>
<p>Este método es el que ha usado el politólogo <a
href="https://twitter.com/ecalvo68">Ernesto Calvo</a> en <a
href="http://elestadista.com.ar/?p=7336">varios</a> <a
href="http://ar.bastiondigital.com/notas/los-gatos-se-estaban-peleando">artículos</a>
muy interesantes (y que son el origen de mi interés por el tema). Y es
el que está detrás de <a
href="https://twitter.com/CIPPEC/status/669631428422983680">este
gráfico</a> que publicó CIPPEC. Si quieren mirar el código, gentilmente
publicado por Calvo, lo reproduzco y analizo <a
href="#segundo-modelo-código-r">acá</a>.</p>
<p>La pregunta que quiero plantear es: ¿qué diferencia
<em>matemática</em> hay entre el resultado de este modelo y el que
presento en la sección anterior? La diferencia teórica es enorme: este
se basa en un modelo bayesiano jerárquico en el que no asume que las
matrices de transferencia sean iguales en cada mesa. El anterior hace
exactamente lo contrario.</p>
<p>Pero matemáticamente los dos están buscando parámetros globales (en
el primer caso <span class="math inline">\(X\)</span> y en este, <span
class="math inline">\(\gamma\)</span>) que minimizan <span
class="math inline">\(\sum_{p=1}^P\sum_{j=1}^3(AX-B)_{pj}^2\)</span>,
sólo que en el primer modelo <span class="math inline">\(X\)</span> es
una variable independiente y, en este, <span
class="math inline">\(X\)</span> está controlado por otros parámetros
que sí son independientes, los <span
class="math inline">\(\gamma\)</span>. Ambos están minimizando una misma
función sobre un dominio. Afirmo que ese dominio es el mismo en ambos
casos.</p>
<p>Los posibles <span class="math inline">\(X\)</span> que explora el
primer modelo son todos los que cumplen <span
class="math inline">\(\sum_{j=1}^3X_{ij}=1\)</span> y <span
class="math inline">\(X_{ij}&gt;0\)</span>. Ese es su dominio. Los
posibles <span class="math inline">\(X\)</span> que explora este modelo
son los que salen de la fórmula <span
class="math inline">\(X_{ij}=\frac{e^{\gamma_{ij}}}{1+e^{\gamma_{i1}}+e^{\gamma_{i2}}}\)</span>
para <span class="math inline">\(j=1,2\)</span> y <span
class="math inline">\(X_{i3}=1-X_{i1}-X_{i2}\)</span>, con <span
class="math inline">\(\gamma\)</span> arbitrario. Pero hay una biyección
entre ambos conjuntos: dado <span class="math inline">\(X\)</span> hay
un único <span class="math inline">\(\gamma\)</span> de donde puede
venir: <span
class="math inline">\(\gamma_{ij}=\ln\left(\frac{X_{ij}}{X_{i3}}\right)\)</span>.
Como están minimizando la misma función sobre el mismo dominio, el
resultado al que llegan va a ser el mismo. Las diferencias que haya se
van a deber a los problemas numéricos que tiene el algoritmo que usa
Calvo y que detallo <a href="#segundo-modelo-código-r">acá</a>.</p>
<h2 id="conclusión">Conclusión</h2>
<p>La conclusión es que si bien el modelo de King, Rosen y Tanner es
teóricamente más sofisticado que el primer modelo que presenté,
matemáticamente son equivalentes. El modelo bayesiano jerárquico no
tiene ningún impacto en el resultado que lo diferencie de la regresión
lineal “controlada” que propuse primero.</p>
<p>Esto quiere decir que los resultados que presenta Calvo en sus
trabajos, a pesar de estar hechos sobre un modelo sofisticado, pueden
ser analizados matemáticamente como si provinieran de un modelo mucho
más simple. Cuando Abel Fernández dice que <a
href="https://abelfer.wordpress.com/2015/11/13/anibal-julian-y-los-votos-de-buenos-aires/">“se
necesita un doctorado en matemática”</a> para evaluar ese trabajo se
equivoca.</p>
<h2 id="trabajo-futuro">Trabajo futuro</h2>
<p>El método de cuadrados mínimos que acabo de describir y analizar no
es el único posible para estimar los parámetros en el modelo de King,
Rosen y Tanner. Como exponen en su paper, se puede usar un algoritmo de
tipo <a
href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">MCMC</a>
acompañado de <a
href="https://en.wikipedia.org/wiki/Gibbs_sampling">Gibbs sampling</a>
para estimar la <em>distribución</em> de los parámetros (y no sólo su
media) mediante inferencia bayesiana. Incluso hay una <a
href="http://rpackages.ianhowson.com/cran/eiPack/">librería R</a> que
implementa dicho método. En cuanto tenga tiempo voy a aplicar esto y
reportar los resultados. La desventaja del método bayesiano es que es
computacionalmente más costoso, por lo que hay que “poner huevo” para
correrlo (con esto quiero decir: ajustar los parámetros con suficiente
pericia para que sea ejecutable en una notebook).</p>
<p>En cuanto al problema general, llamado <em>inferencia ecológica</em>,
al modelo de King, Rosen y Tanner le siguieron desarrollos más
sofisticados, de los que podemos beneficiarnos para obtener una mejor
solución de nuestro problema particular. Ernesto Calvo mismo desarrolló,
junto a Marcelo Escolar, un modelo que parte del de King pero introduce
una variable geográfica. Puede ser de especial interés para las
elecciones argentinas, en las que es obvia la influencia de “factores
geográficos” (simplificando <em>mucho</em>, un “voto urbano”, un “voto
sojero” y un “voto petrolero” manifiestos en la <a
href="http://www.lanacion.com.ar/1848689-como-fue-el-resultado-del-ballottage-en-la-escuela-donde-votaste">distribución
territorial</a> del voto). El trabajo de Calvo y Escolar es el capítulo
11 de <a
href="http://gking.harvard.edu/files/abs/ecinf04-abs.shtml">este
libro</a>.</p>
<h2 id="notas">Notas</h2>
<h3 id="primer-modelo-código-r">Primer modelo: código R</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ei.lls</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>B</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span>
  <span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>B</span><span class='op'>)</span>
  
  <span class='va'>myind</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>)</span> <span class='op'>(</span><span class='va'>i</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>*</span><span class='va'>m</span><span class='op'>+</span><span class='op'>(</span><span class='va'>j</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span><span class='fl'>1</span>
  <span class='va'>AA</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>A</span>
  <span class='va'>AB</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>B</span>
  <span class='va'>Dmat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, nrow<span class='op'>=</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span>, ncol<span class='op'>=</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>)</span>
  <span class='kw'>for</span><span class='op'>(</span><span class='va'>i1</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>n</span><span class='op'>)</span> <span class='kw'>for</span><span class='op'>(</span><span class='va'>i2</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>n</span><span class='op'>)</span> <span class='kw'>for</span><span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>m</span><span class='op'>)</span>
    <span class='va'>Dmat</span><span class='op'>[</span><span class='fu'>myind</span><span class='op'>(</span><span class='va'>i1</span>,<span class='va'>j</span><span class='op'>)</span>, <span class='fu'>myind</span><span class='op'>(</span><span class='va'>i2</span>,<span class='va'>j</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>AA</span><span class='op'>[</span><span class='va'>i1</span>, <span class='va'>i2</span><span class='op'>]</span>
  <span class='va'>dvec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>)</span>
  <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>n</span><span class='op'>)</span> <span class='kw'>for</span><span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>m</span><span class='op'>)</span> <span class='va'>dvec</span><span class='op'>[</span><span class='fu'>myind</span><span class='op'>(</span><span class='va'>i</span>,<span class='va'>j</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>AB</span><span class='op'>[</span><span class='va'>i</span>,<span class='va'>j</span><span class='op'>]</span>
  <span class='va'>Amat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, nrow<span class='op'>=</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>+</span><span class='va'>n</span>, ncol<span class='op'>=</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>)</span>
  <span class='va'>bvec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>+</span><span class='va'>n</span><span class='op'>)</span>
  <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>n</span><span class='op'>)</span> <span class='kw'>for</span><span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>m</span><span class='op'>)</span> <span class='op'>{</span> <span class='va'>Amat</span><span class='op'>[</span><span class='va'>i</span>, <span class='fu'>myind</span><span class='op'>(</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='va'>bvec</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='op'>}</span>
  <span class='kw'>for</span><span class='op'>(</span><span class='va'>ij</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span> <span class='va'>Amat</span><span class='op'>[</span><span class='va'>ij</span><span class='op'>+</span><span class='va'>n</span>, <span class='va'>ij</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='va'>bvec</span><span class='op'>[</span><span class='va'>ij</span><span class='op'>+</span><span class='va'>n</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>; <span class='op'>}</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'>quadprog</span><span class='op'>)</span>
  <span class='va'>sc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/norm.html'>norm</a></span><span class='op'>(</span><span class='va'>Dmat</span>,<span class='st'>"2"</span><span class='op'>)</span> <span class='co'># necesario para que no haya overflow</span>
  <span class='va'>sol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/quadprog/man/solve.QP.html'>solve.QP</a></span><span class='op'>(</span><span class='va'>Dmat</span><span class='op'>/</span><span class='va'>sc</span>, <span class='va'>dvec</span><span class='op'>/</span><span class='va'>sc</span>, <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>Amat</span><span class='op'>)</span>, <span class='va'>bvec</span>, meq<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>S</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sol</span><span class='op'>$</span><span class='va'>solution</span>, nrow<span class='op'>=</span><span class='va'>n</span>, ncol<span class='op'>=</span><span class='va'>m</span>, byrow<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>S</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p><span class="math inline">\(\newcommand{\R}{\mathbb{R}}\)</span>Dadas
matrices <span class="math inline">\(A\in\mathbb{N}^{P\times n}\)</span>
y <span class="math inline">\(B\in\mathbb{N}^{P\times m}\)</span>
devuelve la matriz <span
class="math inline">\(X\in\mathbb{R}_{\geqq0}^{n\times m}\)</span> que
minimiza la función <span
class="math inline">\(f(X)=\sum_{p=1}^P\sum_{j=1}^m
(AX-B)_{pj}^2\)</span>, sujeta a las restricciones <span
class="math inline">\(\sum_{j=1}^m X_{ij} = 1\)</span> para todo <span
class="math inline">\(i\)</span> y, claro, <span
class="math inline">\(X_{ij}\geqq0\)</span>.</p>
<p>Un problema de programación cuadrática es así: minimizar <span
class="math inline">\(m(x)=x^tDx-2d^tx+C\)</span> dado <span
class="math inline">\(Rx\geqq b\)</span>, donde <span
class="math inline">\(x\in\mathbb{R}^N\)</span>, <span
class="math inline">\(D\in\mathbb{R}^{N\times N}\)</span>, <span
class="math inline">\(d\in\R^N\)</span>, <span
class="math inline">\(R\in\R^{r\times n}\)</span> y <span
class="math inline">\(b\in\R^r\)</span>. Tenemos que plantear nuestro
problema en estos términos.</p>
<p>La función a minimizar es</p>
<p><span class="math display">\[f(X)=\sum_{p=1}^P\sum_{j=1}^m
(AX-B)_{pj}^2=\sum_{p=1}^P\sum_{j=1}^m
\left(\sum_{i=1}^nA_{pi}X_{ij}-B_{pj}\right)^2=\]</span></p>
<div>
<span class="math display">\[=\sum_{p=1}^P\sum_{j=1}^m \left(
\left(\sum_{i=1}^nA_{pi}X_{ij}\right)^2-2\left(\sum_{i=1}^nA_{pi}X_{ij}\right)B_{pj}+B_{pj}^2\right)=\]</span>
</div>
<div>
<span class="math display">\[=\sum_{p=1}^P\sum_{j=1}^m \left(
\sum_{i_1=1}^n\sum_{i_2=1}^nA_{pi_1}X_{i_1j}A_{pi_2}X_{i_2j}-2\sum_{i=1}^nA_{pi}X_{ij}B_{pj}+B_{pj}^2\right)=\]</span>
</div>
<div>
<span class="math display">\[=\sum_{i_1=1}^n\sum_{i_2=1}^n\sum_{j=1}^m
\left(\sum_{p=1}^P A_{pi_1}A_{pi_2}\right)
X_{i_1j}X_{i_2j}-2\sum_{i=1}^n\sum_{j=1}^m\left(\sum_{p=1}^PA_{pi}B_{pj}\right)X_{ij}+\sum_{p=1}^P\sum_{j=1}^mB_{pj}^2=\]</span>
</div>
<div>
<span class="math display">\[=\sum_{i_1=1}^n\sum_{i_2=1}^n\sum_{j=1}^m
(A^tA)_{i_1i_2}X_{i_1j}X_{i_2j}-2\sum_{i=1}^n\sum_{j=1}^m(A^tB)_{ij}X_{ij}+C.\]</span>
</div>
<p>Podemos verla como <span
class="math inline">\(m(x)=x^tDx-2d^tx\)</span> considerando la matriz
<span class="math inline">\(X\)</span> como un vector <span
class="math inline">\(x\in\mathbb{R}^N\)</span> con <span
class="math inline">\(N=nm\)</span>, y con <span
class="math inline">\(D_{i_1j,i_2j}=(A^tA)_{i_1i_2}\)</span> y <span
class="math inline">\(d_{ij}=(A^tB)_{ij}\)</span>. Las restricciones
serían <span class="math inline">\(R=I_N\)</span> y <span
class="math inline">\(b=0\)</span>, sumadas a las que fijan <span
class="math inline">\(\sum_{j=1}^m X_{ij} = 1\)</span> para todo <span
class="math inline">\(i\)</span>, que se expresa similarmente. El código
R usa <code>solve.QP</code> para resolver el problema cuadrático,
calculando la entrada como acabo de comentar.</p>
<h3 id="segundo-modelo-código-r">Segundo modelo: código R</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>call.difp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>p</span>,<span class='va'>mx</span>,<span class='va'>my</span>,<span class='va'>nR</span>,<span class='va'>nC</span>,<span class='va'>const</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>gamma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>p</span>,nrow<span class='op'>=</span><span class='va'>nR</span>,ncol<span class='op'>=</span><span class='va'>nC</span><span class='op'>-</span><span class='fl'>1</span>,byrow<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>;
    <span class='va'>ebeta</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>gamma</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>gamma</span><span class='op'>)</span>,<span class='fl'>1</span>,<span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span>;
    <span class='va'>yhat</span>  <span class='op'>&lt;-</span> <span class='va'>mx</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>ebeta</span>;
    <span class='va'>diff</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>-</span><span class='va'>my</span><span class='op'>[</span>,<span class='op'>-</span><span class='va'>nC</span><span class='op'>]</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>const</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>gamma</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>;
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>diff</span><span class='op'>)</span>;
<span class='op'>}</span>

<span class='va'>params.estim</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>,<span class='va'>nR</span>,<span class='va'>nC</span>,<span class='va'>const</span><span class='op'>=</span><span class='fl'>0.001</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>mx</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>nR</span><span class='op'>]</span>;
    <span class='va'>my</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[</span>,<span class='op'>(</span><span class='va'>nR</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>nR</span><span class='op'>+</span><span class='va'>nC</span><span class='op'>)</span><span class='op'>]</span>;
    <span class='va'>nP</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>;
    <span class='va'>parSeed</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>nR</span><span class='op'>*</span><span class='op'>(</span><span class='va'>nC</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>;
    <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/optim.html'>optim</a></span><span class='op'>(</span><span class='va'>parSeed</span>, fn <span class='op'>=</span> <span class='va'>call.difp</span>, method<span class='op'>=</span><span class='st'>"L-BFGS-B"</span>,
                 nR <span class='op'>=</span> <span class='va'>nR</span>, nC <span class='op'>=</span> <span class='va'>nC</span>, mx <span class='op'>=</span> <span class='va'>mx</span>, my <span class='op'>=</span> <span class='va'>my</span>, const <span class='op'>=</span> <span class='va'>const</span><span class='op'>)</span>;
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>par</span><span class='op'>)</span>;
<span class='op'>}</span>

<span class='va'>calc.fractions</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>p</span>,<span class='va'>nR</span>,<span class='va'>nC</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>p.exp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>;
    <span class='va'>p.matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>p.exp</span>,nrow<span class='op'>=</span><span class='va'>nR</span>,byrow<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>;
    <span class='va'>p.sums</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>p.matrix</span>,<span class='fl'>1</span>,<span class='va'>sum</span><span class='op'>)</span>;
    <span class='va'>p.sums</span> <span class='op'>&lt;-</span> <span class='va'>p.sums</span> <span class='op'>+</span> <span class='fl'>1</span>;
    <span class='va'>p.less</span> <span class='op'>&lt;-</span> <span class='va'>p.matrix</span><span class='op'>/</span><span class='va'>p.sums</span>;
    <span class='va'>ests</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>p.less</span>, <span class='fl'>1</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>p.less</span>,<span class='fl'>1</span>,<span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span>;
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>ests</span><span class='op'>)</span>;
<span class='op'>}</span>

<span class='co'># Se llama esta función con A y B como parámetros</span>
<span class='va'>ei.nls</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>A</span>,<span class='va'>B</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>A</span> <span class='op'>&lt;-</span> <span class='va'>A</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span>; <span class='va'>B</span> <span class='op'>&lt;-</span> <span class='va'>B</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>B</span><span class='op'>)</span>
    <span class='va'>Gamma</span> <span class='op'>&lt;-</span> <span class='fu'>params.estim</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>A</span>,<span class='va'>B</span><span class='op'>)</span>,nR<span class='op'>=</span><span class='fl'>7</span>,nC<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
    <span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'>calc.fractions</span><span class='op'>(</span><span class='va'>Gamma</span>,nR<span class='op'>=</span><span class='fl'>7</span>,nC<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>B</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Lo de arriba es una versión simplificada del código que en realidad
publicó Calvo <a href="https://t.co/nxuPmn5pAR">acá</a>. Juro por la
mitad de la carrera de Ciencia de la Computación que hice en la UBA que
funcionalmente es equivalente, es decir, que hace lo mismo.</p>
<p><code>params.estim</code> devuelve <span
class="math inline">\(\gamma\)</span>, según mi notación. Para eso busca
el mínimo de <code>call.difp</code>, que devuelve lo que llamé <span
class="math inline">\(\text{SSE}(\gamma)\)</span> más un factor <span
class="math inline">\(c\sum_{i=1}^7\sum_{j=1}^2\gamma_{ij}^2\)</span>,
con <span class="math inline">\(c=.001\)</span>, que entiendo que está
para controlar que los <span class="math inline">\(\gamma_{ij}\)</span>
no entren a crecer indefinidamente (porque si uno suma una constante a
todos el valor de <span class="math inline">\(X\)</span> no cambia
mucho).</p>
<p><code>calc.fractions</code> devuelve <span
class="math inline">\(X\)</span> dado <span
class="math inline">\(\gamma\)</span>. Lo que hace es aplicar la fórmula
que escribí más arriba: <span
class="math inline">\(X_{ij}=\frac{e^{\gamma_{ij}}}{1+e^{\gamma_{i1}}+e^{\gamma_{i2}}}\)</span>
para <span class="math inline">\(j=1,2\)</span> y <span
class="math inline">\(X_{i3}=1-X_{i1}-X_{i2}\)</span>.</p>
<p>Lo que hay que notar es que el método que usa para buscar el <span
class="math inline">\(\gamma\)</span> que minimiza el error es
<code>optim</code>, que implementa <a
href="https://en.wikipedia.org/wiki/Limited-memory_BFGS">L-BFGS-B</a>.
No es un método de optimización exacto ni específico para este problema,
como sí es el método que usé para resolver el problema cuadrático que
plantea el primer modelo. Como no es exacto y se alimenta, como valor
inicial, con números al azar (la línea
<code>parSeed = rnorm(nR*(nC-1))</code>), cada vez que se corre da
números distintos, a veces <em>muy</em> distintos. <strong>Es por eso
que creo que el primer método es</strong>, además de matemáticamente
equivalente, <strong>numéricamente mejor</strong>.</p>
<p>(En realidad hay dos diferencias más. 1) Cuando
<code>call.difp</code> calcula el error dado <span
class="math inline">\(\gamma\)</span> no tiene en cuenta la última
columna de <span class="math inline">\(B\)</span>. Es decir, sólo apunta
a aproximar la cantidad de votos obtenida por Macri y Scioli; no cuántos
votos se fueron a “No Votó/Blanco”. Estimo que eso es redundante y que
no tiene ningún impacto. Y si lo tiene entiendo que es mejor la opción
que implemento para el primer modelo. 2) <span
class="math inline">\(A\)</span> y <span
class="math inline">\(B\)</span> se toman “normalizadas”, es decir, se
toma <span
class="math inline">\(A_{pi}&#39;=\frac{A_{pi}}{\sum_{k=1}^7A_{pk}}\)</span>,
y similarmente <span class="math inline">\(B&#39;\)</span>. Si los
números <span class="math inline">\(\sum_{k=1}^7A_{pk}\)</span> fueran
iguales en todas las mesas, es decir, si los empadronados en cada mesa
fueran la misma cantidad, no habría diferencia: es lo mismo minimizar
<span class="math inline">\(f(x)\)</span> que <span
class="math inline">\(\lambda f(x)\)</span> si <span
class="math inline">\(\lambda&gt;0\)</span>. En tanto sean distintos, el
efecto es que el primer método penaliza más el error en mesas más
populosas, mientras que este las cuenta todas igual. Estimo que el
impacto es bajo y que si hubiera una diferencia es preferible la opción
del primer modelo: las mesas “grandes” dan más información, así que está
bien privilegiarlas proporcionalmente a su tamaño.)</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
